
editor    = sam
browser   = mothra
gopher    = gopher

#-----------------------------------------------------------------------

label     = 'a-zA-Z0-9\-'

# file and path
name      = $label'¡-￿_,.'
filename  = '['$name']+'
pathname  = '['$name'/]+'

audio     = '((?i)mp3|ogg|flac|wav|au|mid|mus|m3u|pls|plist)'
image     = '((?i)jpe?g|gif|tiff?|ppm|bit|png|pgm|bmp|yuv|tga)'
document  = '((?i)ps|eps|pdf|dvi|doc|epub|cb[tz])'

addrelem  = '((#?[0-9]+)|(/[A-Za-z0-9_\^]+/?)|[.$])'
addr      = '($addrelem([,;+\-]$addrelem)*):?'

# network
protocol  = '(https?|ftps?|file|gopher)'
domain    = '['$label'.]+'
port      = '(:[0-9]+)?'
path      = '['$label'./]+'
query     = '\?['$label'._~&=]*'
url       = $protocol'://('$domain')'$port'('$path')?('$query')?'

user      = '['$label'._]*'
emailaddr = '('$user')@('$domain')'

#-----------------------------------------------------------------------

# rulesets

type    is      text
data    matches $protocol'://[^ ]+'
data    matches $url
v_url   set     $0
attr    add     proto=$1 domain=$2 port=$3 path=$4 query=$5
v_proto set     $1
v_dom   set     $2
{
  v_proto matches 'https?'
  {
    v_dom   matches '.*\.onion'
    data    set     $v_url'.to'  
    plumb   to      web
    plumb   client  window $browser
  }
  {
    plumb   to      web
    plumb   client  window $browser
  }
}
{
  v_proto is      gopher
  plumb   to      gopher
  plumb   client  window $gopher
}
{
  v_proto matches 'ftps?'
  plumb   start   ftpfs $data
}

type    is      text
data    matches $emailaddr
attr    add     user=$1 domain=$2
plumb   to      sendmail
plumb   start   window rc -c '''echo % mail '''$0'; mail '$0

type    is      text
data    matches '(?i)rfc ?([0-9]+)'
attr    add     num=$1
data    set     https://www.rfc-editor.org/rfc/rfc$1.html
plumb   to      web
plumb   client  window $browser

type    is      text
data    matches '('$label')\(([1-9])\)'
plumb   start   rc -c 'man -b '$2' '$1

type    is      text
data    matches 'Local (.*)'
plumb   to      none
plumb   start   rc -c $1

type    is      text
data    matches $filename
arg     isfile  $0
{
  data    matches $filename'\.rtf'
  plumb   to      msword
  plumb   start   wdoc2txt $file
}
{
  data    matches $filename'\.'$audio
  plumb   to      audio
  plumb   start   window -scroll play $file
}
{
  data    matches $filename'\.'$image
  plumb   to      image
  plumb   client  page -wi
}
{
  data    matches $filename'\.'$document
  plumb   to      postscript
  plumb   start   page -w $file
}

type    is      text
data    matches '($filename):($addr)?'
arg     isfile  $1
data    set     $file
attr    add     addr=$2
plumb   to      edit
plumb   client  window $editor
